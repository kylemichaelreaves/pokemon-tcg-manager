FROM node:22-alpine

WORKDIR /app

COPY package.json package-lock.json* ./
COPY backend/package.json ./backend/
COPY config/ ./config/

RUN npm install --workspace=backend

COPY backend/ ./backend/
COPY db/ ./db/

WORKDIR /app/backend

RUN npm run build

EXPOSE 3001

CMD ["node", "dist/server.js"]
